/*
 * tft_lcd.c
 *
 *  Created on: Mar 2, 2024
 *      Author: hojoon
 */

#include "tft_lcd.h"

unsigned char Xcharacter, Ycharacter;
unsigned char Xcursor, Ycursor;
unsigned char XcharacterLimit = 40;
unsigned char YcharacterLimit = 30;
unsigned short foreground_color;
unsigned short background_color;

const unsigned char E_font[128][16] = {		/* 8x16 English ASCII character font */
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // 0x00
		{0xF0,0x08,0x28,0x08,0x08,0x28,0x08,0xF0,0x07,0x08,0x09,0x0B,0x0B,0x09,0x08,0x07}, // 0x01
		{0xF0,0xF8,0xD8,0xF8,0xF8,0xD8,0xF8,0xF0,0x07,0x0F,0x0E,0x0C,0x0C,0x0E,0x0F,0x07}, // 0x02
		{0x00,0xF0,0xF8,0xF8,0xF0,0xF8,0xF8,0xF0,0x00,0x00,0x03,0x07,0x0F,0x07,0x03,0x00}, // 0x03
		{0x00,0x80,0xC0,0xE0,0xF0,0xE0,0xC0,0x80,0x00,0x00,0x01,0x03,0x07,0x03,0x01,0x00}, // 0x04
		{0x00,0xC0,0xC0,0xF8,0xF8,0xF8,0xC0,0xC0,0x00,0x03,0x0B,0x09,0x0F,0x09,0x0B,0x03}, // 0x05
		{0x00,0xC0,0xE0,0xF0,0xF8,0xF0,0xE0,0xC0,0x00,0x01,0x0B,0x0B,0x0F,0x0B,0x0B,0x01}, // 0x06
		{0x00,0x00,0x80,0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x01,0x03,0x03,0x01,0x00,0x00}, // 0x07
		{0xFE,0xFE,0x7E,0x3E,0x3E,0x7E,0xFE,0xFE,0x7F,0x7F,0x7E,0x7C,0x7C,0x7E,0x7F,0x7F}, // 0x08
		{0x00,0xC0,0x60,0x20,0x20,0x60,0xC0,0x00,0x00,0x03,0x06,0x04,0x04,0x06,0x03,0x00}, // 0x09
		{0xFE,0x3E,0x9E,0xDE,0xDE,0x9E,0x3E,0xFE,0x7F,0x7C,0x79,0x7B,0x7B,0x79,0x7C,0x7F}, // 0x0A
		{0x00,0x00,0x80,0xC0,0xE8,0xB8,0x18,0x78,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // 0x0B
		{0x00,0x70,0xF8,0x88,0x88,0xF8,0x70,0x00,0x00,0x02,0x02,0x0F,0x0F,0x02,0x02,0x00}, // 0x0C
		{0x00,0x00,0x00,0xF8,0xF8,0x30,0x60,0xC0,0x00,0x06,0x0F,0x0F,0x07,0x00,0x00,0x00}, // 0x0D
		{0x00,0x00,0xF8,0xF8,0x28,0x28,0xF8,0xF8,0x00,0x07,0x07,0x03,0x00,0x0E,0x0F,0x07}, // 0x0E
		{0x00,0x10,0xC0,0xE0,0x28,0xE0,0xC0,0x10,0x00,0x04,0x01,0x03,0x0A,0x03,0x01,0x04}, // 0x0F
		{0x00,0xF8,0xF0,0xE0,0xC0,0xC0,0x80,0x80,0x00,0x0F,0x07,0x03,0x01,0x01,0x00,0x00}, // 0x10
		{0x00,0x80,0x80,0xC0,0xC0,0xE0,0xF0,0xF8,0x00,0x00,0x00,0x01,0x01,0x03,0x07,0x0F}, // 0x11
		{0x00,0x20,0x30,0xF8,0xF8,0x30,0x20,0x00,0x00,0x02,0x06,0x0F,0x0F,0x06,0x02,0x00}, // 0x12
		{0x00,0x70,0xF8,0xF8,0x00,0xF8,0xF8,0x70,0x00,0x00,0x0D,0x0D,0x00,0x0D,0x0D,0x00}, // 0x13
		{0x70,0xF8,0x88,0xF8,0xF8,0x08,0xF8,0xF8,0x00,0x00,0x00,0x0F,0x0F,0x00,0x0F,0x0F}, // 0x14
		{0x00,0xD8,0xFC,0x24,0x64,0xCC,0x88,0x00,0x00,0x08,0x19,0x13,0x12,0x1F,0x0D,0x00}, // 0x15
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F}, // 0x16
		{0x00,0x20,0x30,0xF8,0xF8,0x30,0x20,0x00,0x00,0x12,0x16,0x1F,0x1F,0x16,0x12,0x00}, // 0x17
		{0x00,0x20,0x30,0xF8,0xF8,0x30,0x20,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00}, // 0x18
		{0x00,0x00,0x00,0xF8,0xF8,0x00,0x00,0x00,0x00,0x02,0x06,0x0F,0x0F,0x06,0x02,0x00}, // 0x19
		{0x00,0x80,0x80,0x80,0x80,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x03,0x01,0x00}, // 0x1A
		{0x00,0x80,0xC0,0xE0,0x80,0x80,0x80,0x80,0x00,0x00,0x01,0x03,0x00,0x00,0x00,0x00}, // 0x1B
		{0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x02,0x02,0x02,0x02,0x02}, // 0x1C
		{0x80,0xC0,0xE0,0x80,0x80,0xE0,0xC0,0x80,0x00,0x01,0x03,0x00,0x00,0x03,0x01,0x00}, // 0x1D
		{0x00,0x00,0x00,0xC0,0xF8,0xC0,0x00,0x00,0x00,0x0C,0x0F,0x0F,0x0F,0x0F,0x0F,0x0C}, // 0x1E
		{0x00,0x18,0x78,0xF8,0xF8,0xF8,0x78,0x18,0x00,0x00,0x00,0x01,0x0F,0x01,0x00,0x00}, // 0x1F
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // space
		{0x00,0x00,0x70,0xF8,0xF8,0x70,0x00,0x00,0x00,0x00,0x00,0x0D,0x0D,0x00,0x00,0x00}, // !
		{0x00,0x20,0x38,0x18,0x20,0x38,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // "
		{0x00,0x20,0xF8,0xF8,0x20,0xF8,0xF8,0x20,0x00,0x02,0x0F,0x0F,0x02,0x0F,0x0F,0x02}, // #
		{0x00,0x60,0xF0,0x9C,0x9C,0xB0,0x20,0x00,0x00,0x02,0x06,0x1C,0x1C,0x07,0x03,0x00}, // $
		{0x00,0x20,0x70,0x70,0xA0,0xC0,0x60,0x20,0x00,0x04,0x06,0x03,0x05,0x0E,0x0E,0x04}, // %
		{0x00,0x00,0xB0,0xF8,0xC8,0x78,0xB0,0x80,0x00,0x07,0x0F,0x08,0x09,0x07,0x0F,0x08}, // &
		{0x00,0x00,0x20,0x38,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // '
		{0x00,0x00,0xE0,0xF0,0x18,0x08,0x00,0x00,0x00,0x00,0x03,0x07,0x0C,0x08,0x00,0x00}, // (
		{0x00,0x00,0x08,0x18,0xF0,0xE0,0x00,0x00,0x00,0x00,0x08,0x0C,0x07,0x03,0x00,0x00}, // )
		{0x00,0x80,0xA0,0xE0,0xC0,0xE0,0xA0,0x80,0x00,0x00,0x02,0x03,0x01,0x03,0x02,0x00}, // *
		{0x00,0x80,0x80,0xE0,0xE0,0x80,0x80,0x00,0x00,0x00,0x00,0x03,0x03,0x00,0x00,0x00}, // +
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x1C,0x0C,0x00,0x00,0x00}, // ,
		{0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // -
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x00}, // .
		{0x00,0x00,0x00,0x00,0x80,0xC0,0x60,0x30,0x00,0x0C,0x06,0x03,0x01,0x00,0x00,0x00}, // /
		{0x00,0xF0,0xF8,0x08,0x08,0xF8,0xF0,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // 0
		{0x00,0x00,0x10,0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x08,0x0F,0x0F,0x08,0x00,0x00}, // 1
		{0x00,0x10,0x18,0x08,0x88,0xF8,0x70,0x00,0x00,0x0C,0x0E,0x0B,0x09,0x08,0x08,0x00}, // 2
		{0x00,0x08,0x08,0x48,0xE8,0xB8,0x18,0x00,0x00,0x04,0x0C,0x08,0x08,0x0F,0x07,0x00}, // 3
		{0x00,0xC0,0xE0,0x30,0xF8,0xF8,0x00,0x00,0x00,0x03,0x03,0x02,0x0F,0x0F,0x02,0x00}, // 4
		{0x00,0x78,0x78,0x48,0x48,0xC8,0x88,0x00,0x00,0x04,0x0C,0x08,0x08,0x0F,0x07,0x00}, // 5
		{0x00,0xE0,0xF0,0x98,0x88,0x88,0x00,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // 6
		{0x00,0x08,0x08,0x88,0xC8,0x78,0x38,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00}, // 7
		{0x00,0x70,0xF8,0x88,0x88,0xF8,0x70,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // 8
		{0x00,0x70,0xF8,0x88,0x88,0xF8,0xF0,0x00,0x00,0x00,0x08,0x08,0x0C,0x07,0x03,0x00}, // 9
		{0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00,0x00}, // :
		{0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x08,0x0E,0x06,0x00,0x00,0x00}, // ;
		{0x00,0x80,0xC0,0x60,0x30,0x18,0x08,0x00,0x00,0x00,0x01,0x03,0x06,0x0C,0x08,0x00}, // <
		{0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x00,0x02,0x02,0x02,0x02,0x02,0x02,0x00}, // =
		{0x00,0x08,0x18,0x30,0x60,0xC0,0x80,0x00,0x00,0x08,0x0C,0x06,0x03,0x01,0x00,0x00}, // >
		{0x00,0x10,0x18,0x88,0xC8,0x78,0x30,0x00,0x00,0x00,0x00,0x0D,0x0D,0x00,0x00,0x00}, // ?
		{0x00,0xF0,0xF8,0x08,0xC8,0xF8,0xF0,0x00,0x00,0x07,0x0F,0x08,0x0B,0x0B,0x01,0x00}, // @
		{0x00,0xE0,0xF0,0x18,0x18,0xF0,0xE0,0x00,0x00,0x0F,0x0F,0x01,0x01,0x0F,0x0F,0x00}, // A
		{0x00,0xF8,0xF8,0x88,0x88,0xF8,0x70,0x00,0x00,0x0F,0x0F,0x08,0x08,0x0F,0x07,0x00}, // B
		{0x00,0xF0,0xF8,0x08,0x08,0x18,0x10,0x00,0x00,0x07,0x0F,0x08,0x08,0x0C,0x04,0x00}, // C
		{0x00,0xF8,0xF8,0x08,0x08,0xF8,0xF0,0x00,0x00,0x0F,0x0F,0x08,0x08,0x0F,0x07,0x00}, // D
		{0x00,0xF8,0xF8,0x88,0x88,0x88,0x08,0x00,0x00,0x0F,0x0F,0x08,0x08,0x08,0x08,0x00}, // E
		{0x00,0xF8,0xF8,0x88,0x88,0x88,0x08,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00}, // F
		{0x00,0xF0,0xF8,0x08,0x08,0x08,0x08,0x00,0x00,0x07,0x0F,0x08,0x09,0x0F,0x0F,0x00}, // G
		{0x00,0xF8,0xF8,0x80,0x80,0xF8,0xF8,0x00,0x00,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x00}, // H
		{0x00,0x00,0x08,0xF8,0xF8,0x08,0x00,0x00,0x00,0x00,0x08,0x0F,0x0F,0x08,0x00,0x00}, // I
		{0x00,0x00,0x00,0x00,0x00,0xF8,0xF8,0x00,0x00,0x04,0x0C,0x08,0x08,0x0F,0x07,0x00}, // J
		{0x00,0xF8,0xF8,0x80,0xE0,0x78,0x18,0x00,0x00,0x0F,0x0F,0x00,0x03,0x0F,0x0C,0x00}, // K
		{0x00,0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x08,0x08,0x08,0x08,0x00}, // L
		{0x00,0xF8,0xF8,0x30,0xE0,0x30,0xF8,0xF8,0x00,0x0F,0x0F,0x00,0x00,0x00,0x0F,0x0F}, // M
		{0x00,0xF8,0xF8,0xE0,0x80,0xF8,0xF8,0x00,0x00,0x0F,0x0F,0x00,0x03,0x0F,0x0F,0x00}, // N
		{0x00,0xF0,0xF8,0x08,0x08,0xF8,0xF0,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // O
		{0x00,0xF8,0xF8,0x88,0x88,0xF8,0x70,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00}, // P
		{0x00,0xF0,0xF8,0x08,0x08,0xF8,0xF0,0x00,0x00,0x07,0x0F,0x08,0x08,0x1F,0x17,0x00}, // Q
		{0x00,0xF8,0xF8,0x88,0x88,0xF8,0x70,0x00,0x00,0x0F,0x0F,0x01,0x03,0x0E,0x0C,0x00}, // R
		{0x00,0x70,0xF8,0x88,0x88,0x98,0x10,0x00,0x00,0x04,0x0C,0x08,0x08,0x0F,0x07,0x00}, // S
		{0x00,0x08,0x08,0xF8,0xF8,0x08,0x08,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00}, // T
		{0x00,0xF8,0xF8,0x00,0x00,0xF8,0xF8,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // U
		{0x00,0xF8,0xF8,0x00,0x00,0xF8,0xF8,0x00,0x00,0x03,0x07,0x0C,0x0C,0x07,0x03,0x00}, // V
		{0x00,0xF8,0xF8,0x00,0x80,0x00,0xF8,0xF8,0x00,0x0F,0x0F,0x06,0x03,0x06,0x0F,0x0F}, // W
		{0x00,0x38,0x78,0xC0,0xC0,0x78,0x38,0x00,0x00,0x0E,0x0F,0x01,0x01,0x0F,0x0E,0x00}, // X
		{0x00,0x78,0xF8,0x80,0x80,0xF8,0x78,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00}, // Y
		{0x00,0x08,0x08,0x88,0xC8,0x78,0x38,0x00,0x00,0x0E,0x0F,0x09,0x08,0x08,0x08,0x00}, // Z
		{0x00,0x00,0xF8,0xF8,0x08,0x08,0x00,0x00,0x00,0x00,0x0F,0x0F,0x08,0x08,0x00,0x00}, // [
		{0x00,0x30,0x60,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x06,0x0C}, /* \ */
		{0x00,0x00,0x08,0x08,0xF8,0xF8,0x00,0x00,0x00,0x00,0x08,0x08,0x0F,0x0F,0x00,0x00}, //]
		{0x00,0x10,0x18,0x0C,0x0C,0x18,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ^
		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20}, // _
		{0x00,0x00,0x00,0x18,0x38,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // `
		{0x00,0x00,0x40,0x40,0x40,0xC0,0x80,0x00,0x00,0x06,0x0F,0x09,0x09,0x0F,0x0F,0x00}, // a
		{0x00,0xF8,0xF8,0x40,0x40,0xC0,0x80,0x00,0x00,0x0F,0x0F,0x08,0x08,0x0F,0x07,0x00}, // b
		{0x00,0x80,0xC0,0x40,0x40,0xC0,0x80,0x00,0x00,0x07,0x0F,0x08,0x08,0x0C,0x04,0x00}, // c
		{0x00,0x80,0xC0,0x40,0x40,0xF8,0xF8,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x0F,0x00}, // d
		{0x00,0x80,0xC0,0x40,0x40,0xC0,0x80,0x00,0x00,0x07,0x0F,0x0A,0x0A,0x0B,0x0B,0x00}, // e
		{0x00,0x80,0xF0,0xF8,0x88,0x98,0x10,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00}, // f
		{0x00,0x80,0xC0,0x40,0x40,0xC0,0x80,0x00,0x00,0x07,0x4F,0x48,0x48,0x7F,0x3F,0x00}, // g
		{0x00,0xF8,0xF8,0x40,0x40,0xC0,0x80,0x00,0x00,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x00}, // h
		{0x00,0x00,0x40,0xD8,0xD8,0x00,0x00,0x00,0x00,0x00,0x08,0x0F,0x0F,0x08,0x00,0x00}, // i
		{0x00,0x00,0x00,0x00,0x40,0xD8,0xD8,0x00,0x00,0x00,0x10,0x30,0x20,0x3F,0x1F,0x00}, // j
		{0x00,0xF8,0xF8,0x00,0x80,0xC0,0x40,0x00,0x00,0x0F,0x0F,0x03,0x07,0x0C,0x08,0x00}, // k
		{0x00,0x00,0x08,0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x08,0x0F,0x0F,0x08,0x00,0x00}, // l
		{0x00,0xC0,0xC0,0xC0,0x80,0xC0,0xC0,0x80,0x00,0x0F,0x0F,0x00,0x07,0x00,0x0F,0x0F}, // m
		{0x00,0xC0,0xC0,0x40,0x40,0xC0,0x80,0x00,0x00,0x0F,0x0F,0x00,0x00,0x0F,0x0F,0x00}, // n
		{0x00,0x80,0xC0,0x40,0x40,0xC0,0x80,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x07,0x00}, // o
		{0x00,0xC0,0xC0,0x40,0x40,0xC0,0x80,0x00,0x00,0x7F,0x7F,0x08,0x08,0x0F,0x07,0x00}, // p
		{0x00,0x80,0xC0,0x40,0x40,0xC0,0xC0,0x00,0x00,0x07,0x0F,0x08,0x08,0x7F,0x7F,0x00}, // q
		{0x00,0xC0,0xC0,0x80,0xC0,0x40,0x40,0x00,0x00,0x0F,0x0F,0x01,0x00,0x00,0x00,0x00}, // r
		{0x00,0x80,0xC0,0x40,0x40,0x40,0x40,0x00,0x00,0x08,0x09,0x09,0x09,0x0F,0x06,0x00}, // s
		{0x00,0x40,0xF8,0xF8,0x40,0x40,0x00,0x00,0x00,0x00,0x07,0x0F,0x08,0x0C,0x04,0x00}, // t
		{0x00,0xC0,0xC0,0x00,0x00,0xC0,0xC0,0x00,0x00,0x07,0x0F,0x08,0x08,0x0F,0x0F,0x00}, // u
		{0x00,0xC0,0xC0,0x00,0x00,0xC0,0xC0,0x00,0x00,0x03,0x07,0x0C,0x0C,0x07,0x03,0x00}, // v
		{0x00,0xC0,0xC0,0x00,0x00,0x00,0xC0,0xC0,0x00,0x07,0x0F,0x0C,0x07,0x0C,0x0F,0x07}, // w
		{0x00,0x40,0xC0,0x80,0x00,0x80,0xC0,0x40,0x00,0x08,0x0C,0x07,0x03,0x07,0x0C,0x08}, // x
		{0x00,0xC0,0xC0,0x00,0x00,0xC0,0xC0,0x00,0x00,0x07,0x4F,0x48,0x48,0x7F,0x3F,0x00}, // y
		{0x00,0x40,0x40,0x40,0xC0,0xC0,0x40,0x00,0x00,0x0C,0x0E,0x0B,0x09,0x08,0x08,0x00}, // z
		{0x00,0x00,0x80,0xF0,0x78,0x08,0x08,0x00,0x00,0x00,0x00,0x07,0x0F,0x08,0x08,0x00}, // {
		{0x00,0x00,0x00,0x78,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00}, // |
		{0x00,0x00,0x08,0x08,0x78,0xF0,0x80,0x00,0x00,0x00,0x08,0x08,0x0F,0x07,0x00,0x00}, // }
		{0x00,0x80,0xC0,0x40,0xC0,0x80,0xC0,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // ~
		{0x00,0x00,0x60,0x90,0x90,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}};// 0x7F


void TFT_LCD_Pin_Init(void)
{
	//	SCB_EnableICache();				// enable L1 instruction cache
	//	SCB_EnableDCache();				// enable L1 data cache
	//
	//	FLASH->ACR = 0x00000307;			// 7 waits, enable ART accelerator and prefetch
	//
	//	RCC->CR = 0x00010001;
	//	RCC->PLLCFGR = 0x09403608;
	//	RCC->CR = 0x01010001;
	//	while((RCC->CR & 0x02000000) == 0);
	//
	//	RCC->CFGR = 0x3040B402;
	//	while((RCC->CFGR & 0x0000000C) != 0x00000008);
	//
	SCB_EnableICache();				// enable L1 instruction cache
	SCB_EnableDCache();				// enable L1 data cache

	FLASH->ACR = 0x00000307;

	RCC->CR |= 0x00010001;
	while((RCC->CR & 0x00000002) == 0);
	RCC->CFGR = 0x00000000;
	while((RCC->CFGR & 0x0000000C) != 0);

	RCC->CR = 0x00010001;
	RCC->PLLCFGR = 0x09403608;
	RCC->CR = 0x01010001;
	while((RCC->CR & 0x02000000) == 0);

	RCC->APB1ENR |= 0x10000000;
	PWR->CR1 |= 0x00010000;
	while((PWR->CSR1 & 0x00010000) == 0);
	PWR->CR1 |= 0x00020000;
	while((PWR->CSR1 & 0x00020000) == 0);

	RCC->CFGR = 0x3040B402;
	while((RCC->CFGR & 0x0000000C) != 0x00000008);
	RCC->CR |= 0x00080000;

	RCC->APB2ENR |= 0x00004000;
	SYSCFG->CMPCR = 0x00000001;

	RCC->AHB1ENR |= 0x0000001F;
	RCC->AHB2ENR |= 0x00000000;

	GPIOC->MODER = 0x00150000;
	GPIOC->ODR = 0x00000000;
	GPIOC->OSPEEDR = 0x00550000;

	GPIOD->MODER  = 0x55005555;
	GPIOD->ODR = 0x00000000;
	GPIOD->OSPEEDR = 0x55005555;
}

void TFT_LCD_Init(void)
{
	RCC->AHB1ENR |= 0x00000018;
	GPIOC->ODR = 0x00000000;
	GPIOC->OSPEEDR = 0x00550000;

	GPIOD->ODR = 0x00000000;
	GPIOD->OSPEEDR = 0x55005555;

	GPIOE->MODER &= 0xFFFFF00F;
	GPIOE->MODER |= 0x00000550;
	GPIOE->ODR |= 0x00000034;
	GPIOE->OSPEEDR &= 0xFFFF00F;
	GPIOE->OSPEEDR |= 0x00000550;

	GPIOE->BSRR = 0x00200000;
	Delay_ms(1);
	GPIOE->BSRR = 0x00000020;
	Delay_ms(120);

	TFT_LCD_Write(0x02, 0x0000);			// window setting
	TFT_LCD_Write(0x03, 0x0000);			// x = 0~319
	TFT_LCD_Write(0x04, 0x0001);
	TFT_LCD_Write(0x05, 0x003F);
	TFT_LCD_Write(0x06, 0x0000);			// y = 0~239
	TFT_LCD_Write(0x07, 0x0000);
	TFT_LCD_Write(0x08, 0x0000);
	TFT_LCD_Write(0x09, 0x00EF);

	TFT_LCD_Write(0x01, 0x0006);			// display setting
	TFT_LCD_Write(0x16, 0x0068);			// MV=1, MX=1, MY=0, BGR=1
	TFT_LCD_Write(0x18, 0x0000);			// SM=0
	TFT_LCD_Write(0x70, 0x0065);			// GS=1, SS=1, 16 bit/pixel
	TFT_LCD_Write(0x23, 0x0095);
	TFT_LCD_Write(0x24, 0x0095);
	TFT_LCD_Write(0x25, 0x00FF);
	TFT_LCD_Write(0x27, 0x0002);
	TFT_LCD_Write(0x28, 0x0002);
	TFT_LCD_Write(0x29, 0x0002);
	TFT_LCD_Write(0x2A, 0x0002);
	TFT_LCD_Write(0x2C, 0x0002);
	TFT_LCD_Write(0x2D, 0x0002);
	TFT_LCD_Write(0x3A, 0x0001);
	TFT_LCD_Write(0x3B, 0x0001);
	TFT_LCD_Write(0x3C, 0x00F0);
	TFT_LCD_Write(0x3D, 0x0000);
	Delay_ms(20);
	TFT_LCD_Write(0x35, 0x0038);
	TFT_LCD_Write(0x36, 0x0078);
	TFT_LCD_Write(0x3E, 0x0038);
	TFT_LCD_Write(0x40, 0x000F);
	TFT_LCD_Write(0x41, 0x00F0);

	TFT_LCD_Write(0x19, 0x0049);			// power setting
	TFT_LCD_Write(0x93, 0x000F);
	Delay_ms(10);
	TFT_LCD_Write(0x20, 0x0040);
	TFT_LCD_Write(0x1D, 0x0007);
	Delay_ms(10);
	TFT_LCD_Write(0x1E, 0x0000);
	TFT_LCD_Write(0x1F, 0x0004);
	TFT_LCD_Write(0x44, 0x0040);			// VCom control for 3.3V
	TFT_LCD_Write(0x45, 0x0012);
	Delay_ms(10);
	TFT_LCD_Write(0x1C, 0x0004);
	Delay_ms(20);
	TFT_LCD_Write(0x43, 0x0080);
	Delay_ms(5);
	TFT_LCD_Write(0x1B, 0x0018);
	Delay_ms(40);
	TFT_LCD_Write(0x1B, 0x0010);
	Delay_ms(40);

	TFT_LCD_Write(0x46, 0x00A4);			// gamma setting
	TFT_LCD_Write(0x47, 0x0053);
	TFT_LCD_Write(0x48, 0x0010);
	TFT_LCD_Write(0x49, 0x005F);
	TFT_LCD_Write(0x4A, 0x0004);
	TFT_LCD_Write(0x4B, 0x003F);
	TFT_LCD_Write(0x4C, 0x0002);
	TFT_LCD_Write(0x4D, 0x00F6);
	TFT_LCD_Write(0x4E, 0x0012);
	TFT_LCD_Write(0x4F, 0x004C);
	TFT_LCD_Write(0x50, 0x0046);
	TFT_LCD_Write(0x51, 0x0044);

	TFT_LCD_Write(0x90, 0x007F);			// display on setting
	TFT_LCD_Write(0x26, 0x0004);
	Delay_ms(40);
	TFT_LCD_Write(0x26, 0x0024);
	TFT_LCD_Write(0x26, 0x002C);
	Delay_ms(40);
	TFT_LCD_Write(0x26, 0x003C);

	TFT_LCD_Write(0x57, 0x0002);			// internal VDDD setting
	TFT_LCD_Write(0x55, 0x0000);
	TFT_LCD_Write(0xFE, 0x005A);
	TFT_LCD_Write(0x57, 0x0000);
}

void TFT_LCD_Command(unsigned short IR)
{
	// CS, RS = 0
	GPIOE->BSRR = 0x00180000;
	GPIOD->ODR = IR;
	GPIOC->ODR = IR;
	GPIOE->BSRR = 0x00040000;

	__NOP();
	__NOP();
	__NOP();
	__NOP();
	__NOP();
	__NOP();
	__NOP();

	GPIOE->BSRR = 0x00000004;	// SET WR
	__NOP();
	GPIOE->BSRR = 0x00000008;	// SET CS
}

void TFT_LCD_Data(unsigned short DR)
{
	// CS = 0, RS = 1
	GPIOE->BSRR = 0x00100008;
	GPIOD->ODR = DR;
	GPIOC->ODR = DR;
	GPIOE->BSRR = 0x00040000;	// RESET WR

//	__NOP();
//	__NOP();
//	__NOP();
//	__NOP();
//	__NOP();
//	__NOP();
//	__NOP();

	GPIOE->BSRR = 0x00000004;	// SET WR
	//	__NOP();
	GPIOE->BSRR = 0x00000008;	// SET CS
}

void TFT_LCD_Write(unsigned short reg, unsigned short value)
{
	TFT_LCD_Command(reg);
	TFT_LCD_Data(value);
}

void TFT_LCD_Color_screen(unsigned short color)
{
	unsigned short i, j;

	TFT_LCD_GRAM_Set(0, 0);

	for(i = 0; i < 240; ++i)
	{
		for(j = 0; j < 320; ++j)
		{
			TFT_LCD_Data(color);
		}
	}
}

void TFT_LCD_GRAM_Set(unsigned short x, unsigned short y)
{
	// Screen Mode = Landscape
	if (x > 319 || y > 239)
		return;
	TFT_LCD_Write(0x02, x >> 8);
	TFT_LCD_Write(0x03, x & 0x00FF);
	TFT_LCD_Write(0x06, 0x0000);
	TFT_LCD_Write(0x07, y);

	TFT_LCD_Command(0x22);
}

void TFT_LCD_xy(unsigned char x, unsigned char y)
{
	Xcharacter = x;
	Ycharacter = y;
}

void TFT_LCD_Color(unsigned short foreground, unsigned short background)
{
	foreground_color = foreground;
	background_color = background;
}

void TFT_LCD_Write_Pixel(unsigned short x, unsigned short y, unsigned short color)
{
	// Landscape
	if (x > 319 || y > 239)
		return;

	TFT_LCD_Write(0x02, x >> 8);
	TFT_LCD_Write(0x03, x & 0x00FF);
	TFT_LCD_Write(0x06, 0x0000);
	TFT_LCD_Write(0x07, y);

	TFT_LCD_Write(0x22, color);
}

void TFT_LCD_Landscape(void)
{
	TFT_LCD_Write(0x16, 0x0068);

	TFT_LCD_Write(0x02, 0x0000);
	TFT_LCD_Write(0x03, 0x0000);
	TFT_LCD_Write(0x04, 0x0001);
	TFT_LCD_Write(0x05, 0x003F);
	TFT_LCD_Write(0x06, 0x0000);
	TFT_LCD_Write(0x07, 0x0000);
	TFT_LCD_Write(0x08, 0x0000);
	TFT_LCD_Write(0x09, 0x00EF);

	XcharacterLimit = 40;
	YcharacterLimit = 30;
}

void TFT_LCD_String(unsigned char x, unsigned char y, unsigned short foreground, unsigned short background, unsigned char* str)
{
	unsigned char ch1;

	Xcharacter = x;
	Ycharacter = y;

	foreground_color = foreground;
	background_color = background;

	while(*str)
	{
		ch1 = *str;
		str++;

		TFT_LCD_English(ch1);
	}
}

void TFT_LCD_English(unsigned char code)
{
	unsigned char data, x, y;
	unsigned short pixel[8][16];
	unsigned short xPos, yPos;

	for(x = 0; x < 8; ++x)
	{
		data = E_font[code][x];
		for(y = 0; y < 8; ++y)
		{
			if (data & 0x01)
				pixel[x][y] = foreground_color;
			else
				pixel[x][y] = background_color;
			data = data >> 1;
		}
	}

	for(x = 0; x < 8; ++x)
	{
		data = E_font[code][x +8];
		for(y = 0; y < 8; ++y)
		{
			if (data & 0x01)
				pixel[x][y + 8] = foreground_color;
			else
				pixel[x][y + 8] = background_color;
			data = data >> 1;
		}
	}

	// Check end of line and end of screen
	if (Xcharacter >= XcharacterLimit)
	{
		Xcharacter = 0;
		Ycharacter += 2;
		if (Ycharacter >= (YcharacterLimit - 1))
			Ycharacter = 0;
	}

	for(y = 0; y < 16; ++y)
	{
		for(x = 0; x < 8; ++x)
		{
			TFT_LCD_Write_Pixel(Xcharacter * 8 + x, Ycharacter * 8 + y, pixel[x][y]);
		}
	}

	Xcharacter += 1;
}


void TFT_LCD_Signed_Decimal(int number, unsigned char zerofill, unsigned char digit)
{
	unsigned char zero_flag, character;
	unsigned int div;

	if((digit == 0) || (digit > 9))
		return;
	if(number >= 0)
		TFT_LCD_English('+');
	else
	{
		TFT_LCD_English('-');
		number = -number;
	}

	div = 1;
	while(--digit)
		div *= 10;
	zero_flag = zerofill;

	while(div > 0)
	{
		character = number / div;
		if((character == 0) && (zero_flag == 0) && (div != 1))
			TFT_LCD_English(character + ' ');
		else
		{
			zero_flag = 1;
			TFT_LCD_English(character + '0');
		}
		number %= div;
		div /= 10;
	}
}

void TFT_LCD_Signed_Float(float number, unsigned char integral, unsigned char fractional)
{
	unsigned char zero_flag, digit, character;
	unsigned int div, integer;

	digit = integral + fractional;
	if((integral == 0) || (fractional == 0) || (digit > 9))
		return;

	// Display sign
	if(number >= 0)
		TFT_LCD_English('+');
	else
	{
		TFT_LCD_English('-');
		number = -number;
	}

	div = 1;

	while(--digit)
		div *= 10;

	while(fractional--)
		number *= 10.;
	integer = (unsigned int)(number + 0.5);

	zero_flag = 0;
	digit = 1;

	while(div > 0)
	{
		character = integer / div;
		if ((character == 0) && (zero_flag == 0) && (digit != integral))
			TFT_LCD_English(character + ' ');
		else
		{
			zero_flag = 1;
			TFT_LCD_English(character + '0');
		}
		integer %= div;
		div /= 10;
		if (digit == integral)
			TFT_LCD_English('.');
		digit++;
	}
}
